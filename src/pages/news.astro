---
import Layout from "../layouts/Layout.astro";
import BrutalSection from "../components/astro/BrutalSection.astro";
import { getCollection } from "astro:content";

// Get all news items from content collection
const newsEntries = await getCollection("news");

// Filter for published items only, sort by date (newest first) and format for display
const newsItems = newsEntries
  .filter((entry) => entry.data.published !== false)
  .sort(
    (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
  )
  .map((entry, index) => {
    const date = new Date(entry.data.date);
    const formattedDate = date
      .toLocaleDateString("en-US", {
        month: "short",
        day: "2-digit",
        year: "numeric",
      })
      .toUpperCase();

    return {
      id: index + 1,
      date: formattedDate,
      title: entry.data.title,
      content: entry.body || "",
      slug: entry.slug,
    };
  });

// Fallback data if no content exists
const fallbackItems = [
  {
    id: 1,
    date: "JAN 15, 2024",
    title: "COUNCIL IGNORES 1,200 SIGNATURES",
    content:
      "Despite overwhelming opposition from residents, the council voted 7-3 to proceed with the Shore Road closure.",
  },
  {
    id: 2,
    date: "JAN 22, 2024",
    title: "EMERGENCY SERVICES SOUND ALARM",
    content:
      "Dorset Fire and Rescue issued an unprecedented warning about response times doubling.",
  },
];

// Use content collection items if available, otherwise use fallback
const displayItems = newsItems.length > 0 ? newsItems : fallbackItems;
---

<Layout title="News">
  <!-- HERO SECTION -->
  <section class="news-hero">
    <h1 class="brutal-headline" style="font-size: clamp(3rem, 8vw, 6rem);">
      BREAKING<br />UPDATES
    </h1>
    <p class="brutal-subhead" style="font-size: clamp(1.2rem, 3vw, 2rem);">
      THE BIG DECISIONS
    </p>
  </section>

  <!-- TIMELINE -->
  <BrutalSection>
    <div class="timeline">
      <!-- Ongoing indicator at top -->
      <div class="timeline-ongoing">
        <div class="timeline-marker ongoing-marker"></div>
        <div class="ongoing-text">THE FIGHT CONTINUES...</div>
      </div>

      {
        displayItems.map((item, index) => (
          <div
            class={`timeline-item fade-in ${index % 2 === 0 ? "timeline-left" : "timeline-right"}`}
          >
            <div class="timeline-marker" />
            <div class="timeline-content">
              <div class="timeline-date">{item.date}</div>
              <h3 class="timeline-title">{item.title}</h3>
              <p class="timeline-text">{item.content}</p>
            </div>
          </div>
        ))
      }
    </div>
  </BrutalSection>

  <!-- STAY INFORMED -->
  <BrutalSection background="concrete">
    <h2 class="brutal-subhead">STAY INFORMED</h2>
    <div class="info-grid">
      <div class="info-card">
        <h3>NEXT SESSION</h3>
        <p class="info-detail">SEPT 1</p>
        <p>Planning & Consultation Meeting</p>
      </div>
      <div class="info-card">
        <h3>LOOKING AHEAD</h3>
        <p class="info-detail">SEPT 15</p>
        <p>Full Council Meeting</p>
      </div>
    </div>
  </BrutalSection>

  <!-- URGENT ACTION -->
  <!-- <BrutalSection background="black">
        <h2 class="brutal-headline" style="font-size: clamp(2.5rem, 6vw, 4rem); color: var(--brutal-red); text-align: center;">
            14 DAYS TO<br/>STOP THE VOTE
        </h2>
        <p style="font-size: 1.25rem; text-align: center; margin: 2rem 0;">
            The September 15 vote will decide Swanage's future. Make your voice heard.
        </p>
        <div style="text-align: center;">
            <a href="/" class="submit-btn" style="display: inline-block; text-decoration: none; margin: 0 1rem;">
                JOIN THE ALLIANCE
            </a>
            <a href="/feed" class="submit-btn" style="display: inline-block; text-decoration: none; margin: 0 1rem; background: var(--brutal-gray); /* Green for action */">
                SHARE YOUR STORY
            </a>
        </div>
    </BrutalSection> -->
</Layout>

<style>
  .news-hero {
    background: var(--brutal-black);
    color: var(--brutal-white);
    padding: 6rem 2rem;
    text-align: center;
    border-bottom: 8px solid var(--brutal-gray); /* Green accent */
  }

  .news-hero .brutal-headline {
    margin-bottom: 1rem;
  }

  /* Enhanced Timeline Styles */
  .timeline {
    position: relative;
    padding: 3rem 0;
    max-width: 1200px;
    margin: 0 auto;
  }

  .timeline::before {
    content: "";
    position: absolute;
    left: 50%;
    top: 0;
    bottom: 0;
    width: 8px;
    background: var(--brutal-black);
    transform: translateX(-50%);
  }

  .timeline-item {
    position: relative;
    width: calc(50% - 60px);
    margin-bottom: 4rem;
  }

  .timeline-left {
    margin-right: auto;
    padding-right: 60px;
    text-align: right;
  }

  .timeline-right {
    margin-left: auto;
    padding-left: 60px;
    text-align: left;
  }

  .timeline-marker {
    position: absolute;
    width: 40px;
    height: 40px;
    background: #ffd700; /* Golden yellow */
    border: 8px solid var(--brutal-black);
    top: 0;
    z-index: 1;
  }

  .timeline-left .timeline-marker {
    right: -24px;
  }

  .timeline-right .timeline-marker {
    left: -24px;
  }

  .timeline-content {
    background: var(--brutal-white);
    border: 4px solid var(--brutal-black);
    padding: 2rem;
    box-shadow: 10px 10px 0 var(--brutal-shadow);
    transition: all 0.3s ease;
  }

  .timeline-content:hover {
    transform: translate(-5px, -5px);
    box-shadow: 15px 15px 0 var(--brutal-shadow);
  }

  .timeline-date {
    font-size: 0.875rem;
    font-weight: 900;
    letter-spacing: 0.2em;
    color: #ffd700; /* Golden yellow */
    margin-bottom: 1rem;
  }

  .timeline-title {
    font-size: 1.5rem;
    font-weight: 900;
    text-transform: uppercase;
    margin-bottom: 1rem;
    line-height: 1.2;
  }

  .timeline-text {
    font-size: 1rem;
    line-height: 1.6;
  }

  /* Ongoing indicator */
  .timeline-ongoing {
    position: relative;
    padding-bottom: 3rem;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding-left: calc(
      50% + 60px
    ); /* Position to the right of the timeline line */
  }

  .ongoing-marker {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    top: 0;
  }

  .ongoing-text {
    font-size: 1.5rem;
    font-weight: 900;
    letter-spacing: 0.2em;
    color: #0066cc;
    opacity: 0.6;
    margin: 0;
    padding-top: 4px;
    text-align: left;
  }

  /* Info Grid */
  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }

  .info-card {
    background: var(--brutal-white);
    border: 4px solid var(--brutal-black);
    padding: 2rem;
    text-align: center;
  }

  .info-card h3 {
    font-size: 1rem;
    font-weight: 900;
    letter-spacing: 0.2em;
    color: #ffd700; /* Golden yellow */
    margin-bottom: 1rem;
  }

  .info-detail {
    font-size: 1.5rem;
    font-weight: 900;
    margin-bottom: 0.5rem;
  }

  /* Mobile Responsive - Vertical Card Stack */
  @media (max-width: 768px) {
    .news-hero {
      padding: 4rem 1rem;
    }

    /* Hide timeline line and ongoing indicator on mobile */
    .timeline::before {
      display: none;
    }

    .timeline-ongoing {
      display: none;
    }

    /* Reset timeline container for mobile card stack */
    .timeline {
      padding: 2rem 0rem;
    }

    /* Transform timeline items into stacked cards */
    .timeline-item {
      width: 100% !important;
      margin: 0 0 2rem 0 !important;
      padding: 0 !important;
      text-align: left !important;
      position: relative;
    }

    /* Hide timeline markers on mobile */
    .timeline-marker {
      display: none;
    }

    /* Enhanced card styling for mobile */
    .timeline-content {
      padding: 1.5rem;
      background: var(--brutal-white);
      border: 4px solid var(--brutal-black);
      box-shadow: 8px 8px 0 var(--brutal-shadow);
      transition: all 0.2s ease;
    }

    .timeline-content:active {
      transform: translate(2px, 2px);
      box-shadow: 6px 6px 0 var(--brutal-shadow);
    }

    .timeline-date {
      font-size: 0.875rem;
      font-weight: 900;
      letter-spacing: 0.15em;
      color: #ffd700;
      margin-bottom: 0.75rem;
      text-transform: uppercase;
    }

    .timeline-title {
      font-size: 1.25rem;
      font-weight: 900;
      line-height: 1.2;
      margin-bottom: 1rem;
      text-transform: uppercase;
    }

    .timeline-text {
      font-size: 1rem;
      line-height: 1.5;
      color: var(--brutal-black);
    }
  }
</style>
