---
import Layout from "../layouts/Layout.astro";
import DataBlock from "../components/astro/DataBlock.astro";
import BrutalSection from "../components/astro/BrutalSection.astro";
import ImpactCard from "../components/astro/ImpactCard.astro";
import { SignUpForm } from "../components/react/SignUpForm";
import { getLeadCount } from "../utils/database";

const leadCount = await getLeadCount();
---

<Layout title="Home">
  <!-- HERO SECTION -->
  <section class="hero">
    <div class="hero-grid">
      {[...Array(9)].map(() => <div class="grid-cell" />)}
    </div>
    <div class="hero-content">
      <div class="hero-main">
        <div class="hero-text">
          <h1 class="brutal-headline">SWANAGE<br />TRAFFIC<br />ALLIANCE</h1>
          <div style="">
            <p class="brutal-subhead">OPENing DIALOGUE</p>
            <p class="brutal-subhead">FOSTERING TRANSPARENCY</p>
          </div>
          <div class="data-block" style="opacity: 1; transform: none;">
            <!-- <div class="data-label">The Electorate's engagement = change</div> -->
            <div class="data-stat">We are all affected</div>
          </div>
        </div>
        <div class="hero-logo">
          <img
            src="/logo-v3.png"
            alt="Swanage Traffic Alliance Logo"
            class="large-hero-logo"
          />
        </div>
      </div>
    </div>
  </section>

  <!-- SCROLL INDICATOR -->
  <div class="scroll-indicator"></div>

  <!-- INTRODUCTION -->
  <section class="story-section fade-in">
    <div class="story-content">
      <div>
        <h2 class="brutal-subhead">THE ALLIANCE</h2>
        <p style="font-size: 1.25rem; margin: 2rem 0; line-height: 1.6;">
          The Swanage Traffic Alliance amplifies your voice, tracks council
          accountability, and gives regular updates on progress. We focus on
          traffic challenges, parking frustrations, and fair use of highways
          funding to influence council deliberations through a unified community
          effort.
        </p>
        <!-- <div class="pull-quote">
          "Why can't I get the problems on my road fixed?"<span
            style="font-size: 1.75rem; opacity: 0.4;">~ Margaret S.</span
          >
        </div> -->
        <!-- <p style="font-size: 1.25rem; opacity: 0.5">~ Margaret S</p> -->
      </div>
      <DataBlock
        label="ACTIVE MEMBERS"
        stat={leadCount.toString()}
        description=""
      />
    </div>
  </section>

  <!-- TRAFFIC SURGE -->
  <!-- <BrutalSection title="THE £75,000 DECEPTION">
    <div class="chart-container">
      <h3 class="brutal-subhead">DCF SURVEY EXPOSED</h3>
      <div class="bar-chart">
        <div class="bar" style="height: 30%;" data-value="387">
          <span class="bar-value">387</span>
          <span class="bar-label">Total Responses</span>
        </div>
        <div class="bar" style="height: 60%;" data-value="71%">
          <span class="bar-value">71%</span>
          <span class="bar-label">Were Visitors</span>
        </div>
        <div class="bar" style="height: 90%;" data-value="10,000+">
          <span class="bar-value">10,000+</span>
          <span class="bar-label">Residents Ignored</span>
        </div>
      </div>
    </div>
    <div class="brutal-info-block">
      <h3 class="brutal-subhead">EVIDENCE OF CORRUPTION</h3>
      <ul style="font-size: 1.25rem; margin-top: 1rem; list-style: none;">
        <li style="margin-bottom: 1rem;">
          ▪ Survey conducted during PEAK TOURIST SEASON
        </li>
        <li style="margin-bottom: 1rem;">
          ▪ Technical failures documented by Granicus Ltd
        </li>
        <li style="margin-bottom: 1rem;">
          ▪ Standing Order 1c used to silence critics
        </li>
        <li>▪ UK Statistics Authority investigating complaints</li>
      </ul>
    </div>
  </BrutalSection> -->

  <!-- IMPACT ANALYSIS -->
  <!-- <BrutalSection title="DORSET HIGHWAYS FUNDING ANALYSIS">
    <div class="impact-grid">
      <ImpactCard
        stat="£75,000"
        description="Allocated to flawed survey feasibility"
      />
      <ImpactCard stat="£500,000" description="Total funds at risk" />
    </div>
  </BrutalSection> -->

  <!-- PARKING CRISIS -->
  <!-- <BrutalSection title="THE DEMOCRATIC DEFICIT">
    <div class="evidence-grid">
      <div class="evidence-card">
        <div class="evidence-number">1</div>
        <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">
          SURVEY MANIPULATION
        </h3>
        <div class="data-stat" style="font-size: 3rem;">?</div>
        <p style="margin-top: 1rem;">Responses used to justify £75,000 spend</p>
      </div>
      <div class="evidence-card">
        <div class="evidence-number">2</div>
        <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">VISITOR BIAS</h3>
        <div class="data-stat" style="font-size: 3rem;">?</div>
        <p style="margin-top: 1rem;">
          Survey respondents were tourists, not residents
        </p>
      </div>
      <div class="evidence-card">
        <div class="evidence-number">3</div>
        <h3 style="font-size: 1.5rem; margin-bottom: 1rem;">
          COUNCIL TRANSPARENCY
        </h3>
        <div class="data-stat" style="font-size: 3rem;">0</div>
        <p style="margin-top: 1rem;">
          Minutes of public consultation published <span
            style="font-size: 0.8rem; opacity: 0.6;"
            >(we'll see about that...)</span
          >
        </p>
      </div>
    </div>
  </BrutalSection> -->

  <!-- CALL TO ACTION -->
  <BrutalSection>
    <h2
      class="brutal-headline"
      style="font-size: clamp(3rem, 8vw, 5rem); text-align: center;"
    >
      <span></span><br />Join the alliance
    </h2>

    <SignUpForm client:load />
  </BrutalSection>
</Layout>

<style>
  /* HERO SECTION */
  .hero {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    background: var(--brutal-black);
    color: var(--brutal-white);
    padding: 2rem;
    position: relative;
    overflow: hidden;
  }

  .hero-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2px;
    position: absolute;
    inset: 0;
    opacity: 0.1;
  }

  .grid-cell {
    background: var(--brutal-white);
    border: 1px solid var(--brutal-white);
  }

  .hero-content {
    position: relative;
    z-index: 10;
    max-width: 1400px;
    margin: 0 auto;
  }

  .hero-main {
    display: flex;
    align-items: flex-start;
    gap: 4rem;
  }

  .hero-text {
    flex: 1;
  }

  .hero-logo {
    flex: 0 0 auto;
    margin-top: -20px; /* Align with top of headline text */
  }

  .large-hero-logo {
    width: 600px;
    height: auto;
    filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8))
      drop-shadow(0 0 20px rgba(255, 255, 255, 0.4));
  }

  .hero .brutal-headline {
    margin-bottom: 2rem;
    animation: slideInBrutal 1s ease-out forwards;
  }

  /* STORY SECTIONS */
  .story-section {
    min-height: 50vh;
    display: flex;
    align-items: center;
    padding: 4rem 2rem;
  }

  .story-content {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: center;
  }

  /* CHARTS */
  .chart-container {
    margin: 2rem 0;
  }

  .bar-chart {
    display: flex;
    align-items: flex-end;
    height: 300px;
    gap: 1rem;
    padding: 3rem;
    background: var(--brutal-white);
    border: 4px solid var(--brutal-black);
    margin-top: 1rem;
  }

  .bar {
    flex: 1;
    background: var(--brutal-gray); /* Green for positive growth */
    position: relative;
    transition: all 0.8s ease-out;
  }

  .bar-label {
    position: absolute;
    bottom: -30px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.875rem;
    white-space: nowrap;
  }

  .bar-value {
    position: absolute;
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
    font-weight: 900;
    font-size: 1.25rem;
  }

  /* BRUTAL INFO BLOCK */
  .brutal-info-block {
    background: var(--brutal-concrete);
    border: 4px solid var(--brutal-black);
    padding: 2rem;
    margin: 2rem 0;
  }

  .brutal-info-block h3 {
    margin-bottom: 1rem;
  }

  /* IMPACT GRID */
  .impact-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 2rem;
    margin: 3rem 0;
  }

  /* EVIDENCE CARDS */
  .evidence-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin: 3rem 0;
  }

  .evidence-card {
    background: var(--brutal-concrete);
    border: 4px solid var(--brutal-black);
    padding: 2rem;
    position: relative;
    overflow: hidden;
  }

  .evidence-number {
    position: absolute;
    top: -20px;
    right: 20px;
    font-size: 6rem;
    font-weight: 900;
    color: #ffd700; /* Golden yellow */
    opacity: 0.2;
  }

  /* SCROLL INDICATOR */
  .scroll-indicator {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 60px;
    border: 4px solid var(--brutal-black);
    background: var(--brutal-white);
    opacity: 0.8;
    animation: bounce 2s infinite;
    z-index: 50;
  }

  .scroll-indicator::before {
    content: "";
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    width: 8px;
    height: 8px;
    background: var(--brutal-black);
    animation: scrollDot 2s infinite;
  }

  @keyframes bounce {
    0%,
    100% {
      transform: translateX(-50%) translateY(0);
    }
    50% {
      transform: translateX(-50%) translateY(10px);
    }
  }

  @keyframes scrollDot {
    0% {
      top: 10px;
    }
    50% {
      top: 30px;
    }
    100% {
      top: 10px;
    }
  }

  /* React SignUpForm Styles - moved to global scope */
  .signup-form-container {
    max-width: 50%;
    margin: 0 auto;
    width: 100%;
  }

  .signup-form-container .action-form {
    background: var(--brutal-white);
    border: 8px solid var(--brutal-black);
    box-shadow: 15px 15px 0 var(--brutal-shadow);
    padding: 3rem;
    margin: 2rem 0;
  }

  .signup-form-container .form-group {
    margin-bottom: 2rem;
  }

  .signup-form-container .form-group label {
    display: block;
    font-family: "Arial Black", sans-serif;
    font-size: 1.2rem;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: -2px;
    margin-bottom: 0.5rem;
    color: var(--brutal-black);
  }

  .signup-form-container .form-group input,
  .signup-form-container .form-group textarea {
    width: 100%;
    padding: 1rem;
    border: 4px solid var(--brutal-black);
    font-size: 1rem;
    font-family: "Arial", sans-serif;
    background: var(--brutal-white);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-sizing: border-box;
  }

  .signup-form-container .form-group input:focus,
  .signup-form-container .form-group textarea:focus {
    outline: none;
    box-shadow: 8px 8px 0 var(--brutal-shadow);
    transform: translate(-2px, -2px);
  }

  .signup-form-container .form-group input.error,
  .signup-form-container .form-group textarea.error {
    border-color: var(--brutal-red);
  }

  .signup-form-container .character-counter {
    display: block;
    margin-top: 0.5rem;
    font-size: 0.9rem;
    color: var(--brutal-gray);
  }

  .signup-form-container .character-counter.warning {
    color: var(--brutal-red);
    font-weight: bold;
  }

  .signup-form-container .error-message {
    color: var(--brutal-red);
    font-weight: bold;
    margin-top: 0.5rem;
    font-size: 0.9rem;
    text-transform: uppercase;
    display: none;
  }

  .signup-form-container .error-message.show {
    display: block;
  }

  .signup-form-container .global-error {
    background: #ffebee;
    border: 2px solid var(--brutal-red);
    padding: 1rem;
    margin-bottom: 1.5rem;
    border-radius: 0;
  }

  .signup-form-container .submit-btn {
    background: var(--brutal-red);
    color: var(--brutal-white);
    border: 4px solid var(--brutal-black);
    padding: 1.5rem 3rem;
    font-family: "Arial Black", sans-serif;
    font-size: 1.5rem;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: -2px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 8px 8px 0 var(--brutal-black);
    width: 100%;
  }

  .signup-form-container .submit-btn:hover:not(:disabled) {
    transform: translate(-4px, -4px);
    box-shadow: 12px 12px 0 var(--brutal-black);
  }

  .signup-form-container .submit-btn:active:not(:disabled) {
    transform: translate(0, 0);
    box-shadow: 4px 4px 0 var(--brutal-black);
  }

  .signup-form-container .submit-btn:disabled {
    background: var(--brutal-gray);
    cursor: not-allowed;
    opacity: 0.7;
    transform: none;
    box-shadow: 8px 8px 0 var(--brutal-black);
  }

  /* Privacy note under submit button */
  .signup-form-container .privacy-note {
    margin-top: 0.75rem;
    font-size: 0.85rem;
    color: var(--brutal-gray);
  }

  .signup-form-container .form-confirmation {
    background: var(--brutal-black);
    color: var(--brutal-white);
    border: 4px solid var(--brutal-red);
    padding: 2rem;
    text-align: center;
    font-family: "Arial Black", sans-serif;
    font-size: 1.2rem;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: -2px;
    margin-top: 1rem;
    animation: confirmSlam 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Ensure confirmation styles also apply when rendered standalone */
  .form-confirmation {
    text-align: center;
    font-size: 1.2rem;
    margin-top: 1rem;
  }

  .signup-form-container .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  @keyframes confirmSlam {
    0% {
      transform: scale(0) rotate(-5deg);
      opacity: 0;
    }
    50% {
      transform: scale(1.1) rotate(2deg);
    }
    100% {
      transform: scale(1) rotate(0);
      opacity: 1;
    }
  }

  /* Tablet/small-device breakpoint to ensure mobile styles apply on ~800px widths */
  @media (max-width: 900px) {
    .signup-form-container {
      max-width: 100%;
      margin: 0 auto;
    }
    .signup-form-container .action-form {
      padding: 1.5rem; /* smaller than desktop 3rem */
      margin: 1rem 0;
    }
    .signup-form-container .submit-btn {
      white-space: nowrap;
    }
  }

  @media (max-width: 768px) {
    /* Reduce hero section padding and height dramatically */
    .hero {
      min-height: 65vh; /* Remove 100vh constraint */
      padding: 2rem 1rem; /* Add some vertical padding instead of centering */
      justify-content: center; /* Align content to top instead of center */
    }

    /* Stack hero content vertically on mobile */
    .hero-main {
      flex-direction: column;
      gap: 2rem;
      text-align: center;
    }

    .large-hero-logo {
      width: 300px;
    }

    /* Reduce hero headline bottom margin by 50% */
    .hero .brutal-headline {
      margin-bottom: 1rem;
    }

    /* Reduce story section padding by 50% */
    .story-section {
      padding: 2rem 1rem;
    }

    .story-content {
      grid-template-columns: 1fr;
      gap: 1rem; /* Reduced from 2rem */
    }

    .bar-chart {
      height: 200px;
    }

    /* SignUpForm mobile styles */
    .signup-form-container {
      max-width: 100%;
      margin: 0 auto;
    }

    .signup-form-container .action-form {
      padding: 1.25rem;
      margin: 0.75rem 0;
      box-shadow: 8px 8px 0 var(--brutal-shadow);
      border-width: 6px;
    }

    .signup-form-container .form-group label {
      font-size: 0.95rem;
      letter-spacing: -1px;
      margin-bottom: 0.35rem;
    }

    .signup-form-container .submit-btn {
      font-size: 1.1rem;
      padding: 1rem 1.25rem;
      white-space: nowrap; /* keep on one row */
    }

    .signup-form-container .form-confirmation {
      font-size: 0.8rem;
      padding: 1.5rem;
    }

    /* Standalone confirmation on mobile */
    .form-confirmation {
      font-size: 0.8rem;
    }

    /* Inputs and textarea should span nearly full width on mobile */
    .signup-form-container .form-group input,
    .signup-form-container .form-group textarea {
      width: 100%;
      padding: 0.9rem;
      font-size: 1rem;
      border-width: 3px;
    }

    /* Character counter smaller on mobile and right-aligned */
    .signup-form-container .character-counter {
      font-size: 0.8rem;
      text-align: right;
    }
  }

  @media (max-width: 1200px) {
    .signup-form-container {
      max-width: 60%;
    }
  }

  @media (max-width: 480px) {
    .signup-form-container {
      max-width: 100%;
    }

    /* Extra-small screens polish */
    .signup-form-container .action-form {
      padding: 1.25rem;
      border-width: 6px;
    }
    .signup-form-container .form-group {
      margin-bottom: 1.25rem;
    }
    .signup-form-container .submit-btn {
      font-size: 1rem;
    }
    .signup-form-container .character-counter {
      font-size: 0.75rem;
      text-align: right;
    }
    .signup-form-container .privacy-note {
      font-size: 0.4rem;
    }
  }
</style>

<script>
  // Non-form JavaScript functionality remains

  // Hide scroll indicator on scroll
  window.addEventListener("scroll", () => {
    const indicator = document.querySelector(
      ".scroll-indicator"
    ) as HTMLElement;
    if (indicator) {
      if (window.scrollY > 100) {
        indicator.style.opacity = "0";
      } else {
        indicator.style.opacity = "0.8";
      }
    }
  });

  // Parallax effect for hero grid
  window.addEventListener("scroll", () => {
    const scrolled = window.pageYOffset;
    const grid = document.querySelector(".hero-grid") as HTMLElement;
    if (grid) {
      grid.style.transform = `translateY(${scrolled * 0.5}px)`;
    }
  });
</script>
